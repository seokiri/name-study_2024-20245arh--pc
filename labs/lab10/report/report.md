---
## Front matter
title: "Лабораторная работа 10"
subtitle: "Работа с файлами средствами Nasm"
author: "Малинина Анастасия Игоревна"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Приобретение навыков написания программ для работы с файлами.


# Задание

1.	Создать каталог для программ лабораторной работы № 10, перейти в него и создать файлы lab10-1.asm, readme.txt, readme-1.txt, readme-2.txt, readme.txt.

2.	Ввести в файл lab10-1.asm текст программы из листинга 1 методического указания. Создать исполняемый файл и проверить его работу.

3.	Изменить права доступа к исполняемому файлу lab10-1, запретив его выполнение.

4.	С помощью команды chmod изменить права доступа к файлу lab10-1.asm с исходным текстом программы, добавив права на исполнение. 

5.	В соответствии с вариантом в таблице методического указания (мой вариант №11) предоставить права доступа к файлу readme-1.txt представленные в символьном виде, а для файла readme-2.txt – в двоичном виде. Проверить правильность выполнения с помощью команды ls -l.



Задание для самостоятельной работы

Напишите программу, работающую по следующему алгоритму: 

Вывод приглашения “Как Вас зовут?” 

ввести с клавиатуры свои фамилию и имя 

создать файл с именем name.txt 

записать в файл сообщение “Меня зовут”

дописать в файл строку введенную с клавиатуры

закрыть файл.

Создать исполняемый файл и проверить его работу. Проверить наличие файла и его содержимое с помощью команд ls и cat.



# Теоретическое введение

Права доступа к файлам

ОС GNU/Linux является многопользовательской операционной системой. 
И для обеспечения защиты данных одного пользователя от действий других пользователей существуют специальные механизмы разграничения доступа к файлам. Кроме ограничения доступа, данный механизм позволяет разрешить другим пользователям доступ данным для совместной работы. Права доступа определяют набор действий (чтение, запись, выполнение), разрешённых для выполнения пользователям системы над файлами. Для каждого файла пользователь может входить в одну из трех групп: владелец, член группы владельца, все остальные. Для каждой из этих групп может быть установлен свой набор прав доступа. Владельцем файла является его создатель.
Набор прав доступа задается тройками битов и состоит из прав на чтение, запись и исполнение файла. В символьном представлении он имеет вид строк rwx, где вместо любого символа может стоять дефис. Всего возможно 8 комбинаций, буква означает наличие права (установлен в единицу второй бит триады r — чтение, первый бит w — запись, нулевой бит х — исполнение), а дефис означает отсутствие права (нулевое значение соответствующего бита). Также права доступа могут быть представлены как восьмеричное число. Так, права доступа rw- (чтение и запись, без исполнения) понимаются как три двоичные цифры 110 или как восьмеричная цифра 6.

Свойства (атрибуты) файлов и каталогов можно вывести на терминал с помощью команды ls с ключом -l. 
Тип файла определяется первой позицией, это может быть: каталог — d, обычный файл — дефис (-) или символьная ссылка на другой файл — l. Следующие 3 набора по 3 символа определяют конкретные права для конкретных групп: r — разрешено чтение файла, w — разрешена запись в файл; x — разрешено исполнение файл и дефис (-) — право не дано. Для изменения прав доступа служит команда chmod, которая понимает как символьное, так и числовое указание прав.

Работа с файлами средствами Nasm.

В операционной системе Linux существуют различные методы управления файлами, например, такие как создание и открытие файла, только для чтения или для чтения и записи, добавления в существующий файл, закрытия и удаления файла, предоставление прав доступа. Обработка файлов в операционной системе Linux осуществляется за счет использования определенных системных вызовов. Для корректной работы и доступа к файлу при его открытии или создании, файлу присваивается уникальный номер (16-битное целое число) – дескриптор файла.

Общий алгоритм работы с системными вызовами в Nasm можно представить в следующем виде: 

Поместить номер системного вызова в регистр EAX; 

Поместить аргументы системного вызова в регистрах EBX, ECX и EDX; 

Вызов прерывания (int 80h); 

Результат обычно возвращается в регистр EAX. 


Открытие и создание файла.

Для создания и открытия файла служит системный вызов sys_creat, который использует следующие аргументы: права доступа к файлу в регистре ECX, имя файла в EBX и номер системного вызова sys_creat (8) в EAX.

Для открытия существующего файла служит системный вызов sys_open, который использует следующие аргументы: права доступа к файлу в регистре EDX, режим доступа к файлу в регистр ECX, имя файла в EBX и номер системного вызова sys_open (5) в EAX. 

Запись в файл.

Для записи в файл служит системный вызов sys_write, который использует следующие аргументы: количество байтов для записи в регистре EDX, строку содержимого для записи ECX, файловый дескриптор в EBX и номер системного вызова sys_write (4) в EAX. 

Системный вызов возвращает фактическое количество записанных байтов в регистр EAX. В случае ошибки, код ошибки также будет находиться в регистре EAX. Прежде чем записывать в файл, его необходимо создать или открыть, что позволит получить дескриптор файла. 

Чтение файла.

Для чтения данных из файла служит системный вызов sys_read, который использует следующие аргументы: количество байтов для чтения в регистре EDX, адрес в памяти для записи прочитанных данных в ECX, файловый дескриптор в EBX и номер системного вызова sys_read (3) в EAX. Как и для записи, прежде чем читать из файла, его необходимо открыть, что позволит получить дескриптор файла.

Закрытие файла.

Для правильного закрытия файла служит системный вызов sys_close, который использует один аргумент – дескриптор файла в регистре EBX. После вызова ядра происходит удаление дескриптора файла, а в случае ошибки, системный вызов возвращает код ошибки в регистр EAX. 

Изменение содержимого файла.

Для изменения содержимого файла служит системный вызов sys_lseek, который использует следующие аргументы: исходная позиция для смещения EDX, значение смещения в байтах в ECX, файловый дескриптор в EBX и номер системного вызова sys_lseek (19) в EAX. 

Удаление файла.

Удаление файла осуществляется системным вызовом sys_unlink, который использует один аргумент – имя файла в регистре EBX.



# Выполнение лабораторной работы


1. Создали каталог для программ лабораторной работы № 10 и создали файлы lab10-1.asm, readme.txt, readme-1.txt, readme-2.txt, readme.txt (рис. 4.1 Создание каталога и файлов для выполнения лабораторной работы).

![Создание каталога и файлов для выполнения лабораторной работы](/home/aimalinina/work/study/2024-2025/Архитектура компьютера/study_2024-2025_arh-pc/labs/lab10/report/image/4.1.jpg){#fig:001 width=70%}


2. Ввели в файл lab10-1.asm текст программы из листинга 1 (Рис. 4.2 Листинг 1). Создали исполняемый файл и проверили его работу (рис. 4.3 Результаты работы программы из листинга 1).

![Листинг 1](/home/aimalinina/work/study/2024-2025/Архитектура компьютера/study_2024-2025_arh-pc/labs/lab10/report/image/4.2.jpg){#fig:002 width=70%}

![Результаты работы программы из листинга 1](/home/aimalinina/work/study/2024-2025/Архитектура компьютера/study_2024-2025_arh-pc/labs/lab10/report/image/4.3.jpg){#fig:003 width=70%}

![Содержание файла readme.txt](/home/aimalinina/work/study/2024-2025/Архитектура компьютера/study_2024-2025_arh-pc/labs/lab10/report/image/4.4.jpg){#fig:004 width=70%}

3. С помощью команды chmod изменили права доступа к исполняемому файлу lab10-1, запретив его выполнение (рис. 4.5 Изменение прав доступа к файлу).

![Изменение прав доступа к файлу](/home/aimalinina/work/study/2024-2025/Архитектура компьютера/study_2024-2025_arh-pc/labs/lab10/report/image/4.5.jpg){#fig:005 width=70%}


При попытке выполнить файл выдало сообщение, что отказано в доступе.

4. С помощью команды chmod изменили права доступа к файлу lab10-1.asm с исходным текстом программы, добавив права на исполнение (рис. 4.6 Изменение прав доступа к файлу lab10-1.asm).
 
![Изменение прав доступа к файлу lab10-1.asm](/home/aimalinina/work/study/2024-2025/Архитектура компьютера/study_2024-2025_arh-pc/labs/lab10/report/image/4.6.jpg){#fig:006 width=70%}

С помощью команды я дала разрешение на исполнение файлу с исходным текстом и перекомпилировала программу, она заработала, так как файл был со всеми разрешениями. После повторной компиляции это фактически «новая программа», поэтому они и запустилась.

5. В соответствии с вариантом в таблице методического указания (мой вариант №1) предоставили права доступа к файлу readme-1.txt представленные в символьном виде (рис. 4.7 Права доступа для файла readme-1.txt), а для файла readme-2.txt – в двочном виде (рис. 4.8 Права доступа для файла readme-2.txt). 

Проверили правильность выполнения с помощью команды ls -l.

![Права доступа для файла readme-1.txt](/home/aimalinina/work/study/2024-2025/Архитектура компьютера/study_2024-2025_arh-pc/labs/lab10/report/image/4.7.jpg){#fig:007 width=70%}

![Права доступа для файла readme-2.txt](/home/aimalinina/work/study/2024-2025/Архитектура компьютера/study_2024-2025_arh-pc/labs/lab10/report/image/4.8.jpg){#fig:008 width=70%}


Задание для самостоятельной работы

1. Напишите программу работающую по следующему алгоритму: 

Вывод приглашения “Как Вас зовут?” 

ввести с клавиатуры свои фамилию и имя 

создать файл с именем name.txt 

записать в файл сообщение “Меня зовут”

дописать в файл строку введенную с клавиатуры

закрыть файл.

Создать исполняемый файл и проверить его работу. Проверить наличие файла и его содержимое с помощью команд ls и cat.


![Листинг самостоятельного задания №1](/home/aimalinina/work/study/2024-2025/Архитектура компьютера/study_2024-2025_arh-pc/labs/lab10/report/image/4.9.jpg){#fig:009 width=70%}


![Продолжение листинга самостоятельного задания №1](/home/aimalinina/work/study/2024-2025/Архитектура компьютера/study_2024-2025_arh-pc/labs/lab10/report/image/4.10.jpg){#fig:010 width=70%}

![Результаты работы программы по самостоятельному заданию №1](/home/aimalinina/work/study/2024-2025/Архитектура компьютера/study_2024-2025_arh-pc/labs/lab10/report/image/4.11.jpg){#fig:011 width=70%}


![Содержимое файла name.txt](/home/aimalinina/work/study/2024-2025/Архитектура компьютера/study_2024-2025_arh-pc/labs/lab10/report/image/4.12.jpg){#fig:012 width=70%}



# Выводы

Приобрели навыки написания программ для работы с файлами.

# Список литературы{.unnumbered}

1.	GDB: The GNU Project Debugger. — URL:https://www.gnu.org/software/gdb/. 
2.	GNU Bash Manual. — 2016. — URL: https://www.gnu.org/software/bash/manual/. 
3.	Midnight Commander Development Center. — 2021. — URL: https://midnight-commander. org/. 
4.	NASM Assembly Language Tutorials. — 2021. — URL: https://asmtutor.com/. 
5.	Newham C. Learning the bash Shell: Unix Shell Programming. — O’Reilly Media, 2005. — 354 с. — (In a Nutshell). — ISBN 0596009658. — URL: http://www.amazon.com/Learningbash-Shell-Programming-Nutshell/dp/0596009658.
6.	Robbins A. Bash Pocket Reference. — O’Reilly Media, 2016. — 156 с. — ISBN 978-1491941591.
7.	The NASM documentation. — 2021. — URL: https://www.nasm.us/docs.php.
8.	Zarrelli G. Mastering Bash. — Packt Publishing, 2017. — 502 с. — ISBN 9781784396879.
9.	Колдаев В. Д., Лупин С. А. Архитектура ЭВМ. — М. : Форум, 2018.
10.	Куляс О. Л., Никитин К. А. Курс программирования на ASSEMBLER. — М. : Солон-Пресс, 2017.
11.	Новожилов О. П. Архитектура ЭВМ и систем. — М. : Юрайт, 2016.
12.	Расширенный ассемблер: NASM. — 2021. — URL: https://www.opennet.ru/docs/RUS/nasm/. 
13.	Робачевский А., Немнюгин С., Стесик О. Операционная система UNIX. — 2-е изд. — БХВПетербург, 2010. — 656 с. — ISBN 978-5-94157-538-1. 
14.	Столяров А. Программирование на языке ассемблера NASM для ОС Unix. — 2-е изд. — М. : МАКС Пресс, 2011. — URL: http://www.stolyarov.info/books/asm_unix.
15.	 Таненбаум Э. Архитектура компьютера. — 6-е изд. — СПб. : Питер, 2013. — 874 с. — (Классика Computer Science).
16.	Таненбаум Э., Бос Х. Современные операционные системы. — 4-е изд. — СПб. : Питер, 2015. — 1120 с. — (Классика Computer Science).


::: {#refs}
:::
